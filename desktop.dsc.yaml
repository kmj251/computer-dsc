# yaml-language-server: $schema=https://aka.ms/configuration-dsc-schema/0.2
properties:
  assertions:
    - resource: Microsoft.Windows.Developer/OsVersion
      directives:
        description: Verify min OS version requirement
        allowPrerelease: true
      settings:
        MinVersion: '10.0.26200'
  configurationVersion: 0.2.0
  resources:
    - resource: PSDscResources/Registry
      id: DesktopSmallIcons
      directives:
        description: Set small icons on desktop
        allowPrerelease: true
      settings:
        Key: HKEY_CURRENT_USER\Software\Microsoft\Windows\Shell\Bags\1\Desktop
        ValueName: IconSize
        ValueData: 24
        ValueType: DWord
        Force: true
        Ensure: Present
    - resource: PSDscResources/Registry
      id: DesktopAutoArrange
      directives:
        description: Enable auto arrange on desktop
        allowPrerelease: true
      settings:
        Key: HKEY_CURRENT_USER\Software\Microsoft\Windows\Shell\Bags\1\Desktop
        ValueName: FFlags
        ValueData: 1075839525
        ValueType: DWord
        Force: true
        Ensure: Present
    - resource: PSDscResources/Registry
      id: DesktopSortByName
      directives:
        description: Sort desktop icons by name
        allowPrerelease: true
      settings:
        Key: HKEY_CURRENT_USER\Software\Microsoft\Windows\Shell\Bags\1\Desktop
        ValueName: Sort
        ValueData: "00000000"
        ValueType: Binary
        Force: true
        Ensure: Present
    - resource: PSDscResources/Registry
      id: DesktopIconSpacingHorizontal
      directives:
        description: Reduce horizontal spacing between desktop icons
        allowPrerelease: true
      settings:
        Key: HKEY_CURRENT_USER\Control Panel\Desktop\WindowMetrics
        ValueName: IconSpacing
        ValueData: "-1000"
        ValueType: String
        Force: true
        Ensure: Present
    - resource: PSDscResources/Registry
      id: DesktopIconSpacingVertical
      directives:
        description: Reduce vertical spacing between desktop icons
        allowPrerelease: true
      settings:
        Key: HKEY_CURRENT_USER\Control Panel\Desktop\WindowMetrics
        ValueName: IconVerticalSpacing
        ValueData: "-1000"
        ValueType: String
        Force: true
        Ensure: Present
    - resource: PSDscResources/Registry
      id: DesktopIconThisPC
      directives:
        description: Show This PC icon on desktop
        allowPrerelease: true
      settings:
        Key: HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\NewStartPanel
        ValueName: "{20D04FE0-3AEA-1069-A2D8-08002B30309D}"
        ValueData: 0
        ValueType: DWord
        Force: true
        Ensure: Present
    - resource: PSDscResources/Registry
      id: DesktopIconUserFiles
      directives:
        description: Show User's Files icon on desktop
        allowPrerelease: true
      settings:
        Key: HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\NewStartPanel
        ValueName: "{59031a47-3f72-44a7-89c5-5595fe6b30ee}"
        ValueData: 0
        ValueType: DWord
        Force: true
        Ensure: Present
    - resource: PSDscResources/Registry
      id: DesktopIconNetwork
      directives:
        description: Show Network icon on desktop
        allowPrerelease: true
      settings:
        Key: HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\NewStartPanel
        ValueName: "{F02C1A0D-BE21-4350-88B0-7367FC96EF3C}"
        ValueData: 0
        ValueType: DWord
        Force: true
        Ensure: Present
    - resource: PSDscResources/Script
      id: RestartExplorerForDesktop
      dependsOn:
        - DesktopSmallIcons
        - DesktopAutoArrange
        - DesktopSortByName
        - DesktopIconSpacingHorizontal
        - DesktopIconSpacingVertical
      directives:
        description: Restart Explorer to apply desktop changes
        allowPrerelease: true
      settings:
        GetScript: |
          return @{ Result = (Get-Process -Name explorer -ErrorAction SilentlyContinue) }
        TestScript: |
          return $false
        SetScript: |
          Stop-Process -Name explorer -Force
          Start-Sleep -Seconds 2
          Start-Process explorer
